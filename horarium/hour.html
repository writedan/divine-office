<html>
    <head>
        <title>Horarium</title>
        <script src='./suncalc.js'></script>
        <script src ='./lit-time.js'></script>
        <script src='./liturgy.js'></script>
        <script src='./lit-calendar.js'></script>
        <script src='./lit-compile.js'></script>
        <link rel='stylesheet' type='text/css' href='./liturgy.css'/>
        <style>
            .error {
                background-color: #f8d7da; /* Light red */
                border: 1px solid #f5c6cb; /* Darker red */
                color: #721c24; /* Dark red */
                padding: 10px 15px;
                margin-bottom: 20px;
                border-radius: 5px;
            }

            p {
                text-align: justify;
            }

            .instruction {
                color: red;
                font-style: italic;
            }

            .psalm {
                display: grid;
                  grid-template-columns: 1fr 1fr; /* Two equal-width columns */
                  grid-column-gap: 40px; /* Adjust the gap between columns */
            }

            .psalm p {
                margin-bottom: 5px;
            }

            .title {
                text-align:center;
                font-size: 85%;
                font-weight: bold;
                grid-column: 1 / -1;
            }
        </style>
    </head>
    <body>
       <div id="container">
            <div id="form-container">
            </div>
            <div id='content-container'></div>
            <div id="content">
            </div>
        </div>
    </body>

    <script>
        annotateTemporalMetadata(tMeta)
        
        const urlParams = new URLSearchParams(window.location.search);
        let today = getLiturgicalDay(new Date(urlParams.get('date')))
        let hour = urlParams.get('hour')
        var firstVespers = false;
        if (hour == 'FirstVespers' || hour == 'FirstCompline') {
            firstVespers = true;
            hour = hour.substring(5)
            console.log("Liturgical day began at Vespers. We need yesterday's horarium.");
            today = getLiturgicalDay(advdat(new Date(urlParams.get('date')), -1))
        }
        let metadata = today.hours[hour].metadata;
        document.title = metadata.name + ' at ' + ((firstVespers && hour != 'Compline') ? 'First ' : '') + hour;

        let content = document.getElementById('content');
        let sidebar = document.getElementById('form-container');

        let h1 = document.createElement('h3');
        h1.innerHTML = metadata.name;
        h1.style.color = metadata.color;
        content.append(h1);

        let h2 = document.createElement('h3');
        h2.innerHTML = 'Horarium';
        h2.style.width = '100%'
        sidebar.append(h2);

        let hourData = metadata.hours[urlParams.get('hour')]
        let lctx = new LiturgyContext(hourData.order);
        lctx.setField('psalter', hourData.psalter);
        lctx.setField('hymn', hourData.commons.hymn);
        lctx.setField('kyrie', hourData.kyrie);
        lctx.setField('invitatory', hourData.commons.invitatory);
        lctx.setField('chapter', hourData.commons.chapter);
        lctx.setField('versicle', hourData.commons.versicle);

        lctx.execute().then(result => {
            for (let r of result) {
                document.getElementById('content').appendChild(r);
            }
        })
    </script>
</html>