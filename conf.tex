\documentclass[14pt,twoside]{extarticle}
\usepackage{moresize}
\usepackage{fontspec}
\usepackage{aeguill}
\usepackage{titlesec}
\usepackage[maxlevel=3]{csquotes}
\usepackage{lettrine}
\usepackage{xifthen}
\usepackage{yfonts}
\usepackage{parskip}
\usepackage[dvipsnames]{xcolor}
\usepackage{fancyhdr}
\usepackage{hanging}
\usepackage[autocompile,allowdeprecated=false]{gregoriotex}
\usepackage[twoside]{geometry}
\usepackage{multicol}
\usepackage{paracol}
\usepackage[latin,english]{babel}
\usepackage{enumitem}
\usepackage{tabto}
\usepackage{titlesec}
\usepackage[savepos]{zref}
%\usepackage{libertine}

\setlength{\columnseprule}{0.025pt}
\setlength{\columnsep}{1.5em}
\setlength{\topskip}{7pt}

\def\vehymn{-0.50}

\makeatletter
\patchcmd{\pcol@buildcolseprule}%
{\hrule\@height\@tempdima\@width\columnseprule}%
{\hrule\@height\dimexpr\@tempdima-0.5ex\@width\columnseprule\@depth-1pt}{}{}
\makeatother

\gredefsizedsymbol{GreCross}{greextra}{Cross}
\gredefsizedsymbol{GreDagger}{greextra}{Dagger}
\gredefsizedsymbol{GreCrossAlt}{greextra}{Cross.alt}
\gredefsizedsymbol{GreStarHeight}{greextra}{StarHeight}
\gredefsizedsymbol{greABar}{greextra}{ABar}
\gredefsizedsymbol{greVBar}{greextra}{VBar}
\gredefsizedsymbol{greRBar}{greextra}{RBar}

\gresetspecial{r}{\textcolor{red}{\Rbar{}.}}
\gresetspecial{v}{\textcolor{red}{\Vbar{}.}}
\gresetspecial{a}{\textcolor{red}{\Abar{}.}}
\gresetspecial{+}{\textcolor{red}{\GreCross{17}}}
\gresetspecial{1}{\textcolor{red}{\GreDagger{17}}}
\gresetspecial{2}{\textcolor{red}{\GreCrossAlt{17}}}
\gresetspecial{*}{\textcolor{red}{\GreStarHeight{17}}}
%%% for spacing in chant %%%
\gresetspecial{ }{\textcolor{white}{a}}
\gresetspecial{  }{\textcolor{white}{be}}
\gresetspecial{   }{\textcolor{white}{God}}
\gresetspecial{    }{\textcolor{white}{text}}

\grechangestaffsize{30}
%\grechangedim{abovelinestextheight}{0.25cm}{fixed}
%\grechangedim{spacebeneathtext}{0.5cm}{fixed}
\grechangedim{annotationseparation}{0.25cm}{fixed}

\newcommand{\skiplines}[1]{\vspace*{#1\baselineskip}}

\newcommand{\veformat}[1]{\textcolor{red}{\textbf{#1}}}
\newcommand{\veant}[2]{\greannotation{#1. \veformat{Ant.}}\greannotation{\veformat{#2.}}}
\newcommand{\instruct}[1]{\textcolor{red}{\textit{#1}}}

\makeatletter
\newcommand{\whiteribbon}[0]{\textcolor{black}{\textbf{white ribbon}} }%
\newcommand{\greenribbon}[0]{\textcolor{ForestGreen}{\textbf{green ribbon}} }%
\newcommand{\redribbon}[0]{\textcolor{red}{\textbf{red ribbon}} }%
\newcommand{\blueribbon}[0]{\textcolor{blue}{\textbf{blue ribbon}} }%
\makeatother

%%% HEADERS %%%
\newcommand{\vepart}[1]{%
	\cleardoublepage%
	\vspace*{\fill}%
	\begin{center}%
		{\Huge \selectfont \uppercase{ \textbf{#1}}}%
	\end{center}%
	\vspace*{\fill}%
}%
\makeatother

\newcommand{\vechapter}[1]{%
	\cleardoublepage%
	\begin{center}
		{\LARGE \selectfont \color{red} \uppercase{ \textbf{#1}}}\par%
	\end{center}
	\skiplines{1}
}%
\makeatother

\newcommand{\vesectionp}[1]{%
	\skiplines{1}
	\begin{center}
		{\Large \selectfont \uppercase{ \textbf{#1}}}%
	\end{center}
	\skiplines{1}
}%
\makeatother

\newcommand{\vesection}[1]{%
	\clearpage\skiplines{-2}\vesectionp{#1}%
}%
\makeatother

\makeatletter
\newcommand{\veheading}[1]{%
	\skiplines{0.5}%
	\begin{center}
		{\selectfont \textit{#1}}%
	\end{center}
	\skiplines{0.5}
}%
\makeatother

\makeatletter
\newcommand{\vecomment}[1]{%
	\hfill{\small\selectfont \textit{#1}.}%
}%
\makeatother

%%% OTHER FORMATS %%%

\makeatletter
\newcommand{\red}[1]{%
	{\color{red} #1}%
}%
\makeatother

\makeatletter
\newcommand{\chapter}[1]{%
	\gresetinitiallines{1}%
	\greannotation{\veformat{Chap.}}%
	\greannotation{\veformat{Dir.}}%
	\gabcsnippet{#1}%
}%
\makeatother

\makeatletter
\newcommand{\resp}[2]{%
	\vecomment{#1}
	
	\gresetinitiallines{1}%
	\greannotation{\veformat{Resp.}}%
	\greannotation{\veformat{#2.}}%
}%
\makeatother

\makeatletter
\newcommand{\tone}[2]{%
	\greannotation{\veformat{Ps.}}
	\greannotation{\veformat{#1.}}
	
	\gabcsnippet{#2}
}%
\makeatother

\makeatletter
\newcommand{\repant}[1]{%
	\gresetspecial{*}{}
	\nopagebreak[4]\skiplines{1}\nopagebreak[4]\gresetinitiallines{0}\gregorioscore{#1}\gresetinitiallines{1}
	\gresetspecial{*}{\textcolor{red}{\GreStarHeight{17}}}
}%
\makeatother



%%% FANCY %%%
\makeatletter  
\newcounter{score}
\newcounter{tabstop}[score]
\newcommand{\grealign}{%
	\@bsphack%
	\ifgre@boxing\else%
	\kern\gre@dimen@begindifference%
	\stepcounter{tabstop}%
	\expandafter\zsavepos{stop-\thescore-\thetabstop}%
	\kern-\gre@dimen@begindifference%
	\fi%
	\@esphack%
}

\newcommand{\setstops}{%
	\gdef\nstabbing@stops{%
		\hspace*{-\oddsidemargin}\hspace{-1in}%
		\hspace*{\zposx{stop-\thescore-1} sp}\=%
	}%
	\count@=\@ne
	\loop\ifnum\count@<\value{tabstop}%
	\begingroup\edef\x{\endgroup
		\noexpand\g@addto@macro\noexpand\nstabbing@stops{%
			\noexpand\hspace{-\noexpand\zposx{stop-\thescore-\the\count@} sp}%
			\noexpand\hspace{\noexpand\zposx{stop-\thescore-\the\numexpr\count@+1} sp}\noexpand\=%
		}%
	}\x
	\advance\count@\@ne
	\repeat
	\nstabbing@stops\kill
}
\makeatother

\newenvironment{nstabbing}
{\setlength{\topsep}{0pt}%
	\setlength{\partopsep}{0pt}%
	\tabbing%
	\setstops}
{\endtabbing\stepcounter{score}}